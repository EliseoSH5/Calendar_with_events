<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendario de Eventos</title>

  <!-- Iconos -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-MW6bT4fXk3Jgqk6FfGm8kqg8k8wqC0k1H8U4iD9F8qP5t3ZQhE3z4zqXhG0r1qg7z9kQwWJqD2J3K1Z0Q6QQ3A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <noscript>Necesitas habilitar JavaScript para usar este calendario.</noscript>

  <div class="container">
    <!-- Panel izquierdo: Calendario -->
    <div class="left">
      <div class="calendar" tabindex="-1">
        <div class="month">
          <i class="fas fa-angle-left prev" aria-label="Mes anterior" role="button" tabindex="0"></i>
          <div class="date" aria-live="polite">Mes Año</div>
          <i class="fas fa-angle-right next" aria-label="Mes siguiente" role="button" tabindex="0"></i>
        </div>

        <div class="weekdays"></div>
        <div class="days" aria-label="Días del mes"></div>

        <div class="goto-today">
          <div class="goto">
            <input type="text" class="date-input" placeholder="mm/yyyy" inputmode="numeric" aria-label="Ir a fecha (mm/yyyy)" />
            <button class="goto-btn" type="button">Ir</button>
          </div>
          <button class="today-btn" type="button">Hoy</button>
        </div>
      </div>
    </div>

    <!-- Panel derecho: Eventos del día -->
    <div class="right">
      <div class="today-date">
        <div class="event-day" aria-live="polite"></div>
        <div class="event-date" aria-live="polite"></div>
      </div>

      <div class="events" aria-label="Eventos del día">
        <!-- Se rellena dinámicamente desde script.js -->
      </div>

      <!-- Botón para abrir modal -->
      <div class="add-event-footer">
        <button class="add-event" type="button" aria-haspopup="dialog" aria-controls="addEventDialog">
          <i class="fa fa-plus"></i> Agregar evento
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Agregar/Editar Evento -->
  <div class="add-event-wrapper" id="addEventDialog" aria-hidden="true">
    <div class="add-event" role="dialog" aria-modal="true" aria-labelledby="addEventTitle">
      <div class="add-event-header">
        <h3 id="addEventTitle">Agregar evento</h3>
        <button class="close" aria-label="Cerrar modal" type="button">&times;</button>
      </div>

      <div class="add-event-form">
        <!-- Básico -->
        <div class="form-row">
          <label for="evName">Título *</label>
          <input id="evName" class="event-name" type="text" placeholder="Ej. Reunión de avance" required />
        </div>

        <div class="form-row">
          <div>
            <label for="evFrom">Hora de inicio *</label>
            <input id="evFrom" class="event-time-from" type="time" required />
          </div>
        </div>

        <!-- Clasificación (sin 'Horario', sin 'Categoría') -->
        <div class="form-row two">
          <div>
            <label for="evUrgency">Urgencia</label>
            <!-- Puedes escribir: roja | media | baja (o ‘Alta/Media/Baja’ y el JS normaliza) -->
            <select id="evUrgency" class="event-urgency">
              <option value="">— Selecciona —</option>
              <option>Alta</option>
              <option>Media</option>
              <option>Baja</option>
            </select>
          </div>
          <div>
            <label for="evStatus">Estado</label>
            <select id="evStatus" class="event-status">
              <option value="">— Selecciona —</option>
              <option>Planificado</option>
              <option>En curso</option>
              <option>Completado</option>
              <option>Cancelado</option>
            </select>
          </div>
        </div>

        <!-- Contexto -->
        <div class="form-row two">
          <div>
            <label for="evWell">Pozo</label>
            <input id="evWell" class="event-well" type="text" placeholder="Ej. Mulach-32" />
          </div>
          <div>
            <label for="evTool">Herramienta</label>
            <input id="evTool" class="event-tool" type="text" placeholder="Ej. PDC BT616SM" />
          </div>
        </div>

        <div class="form-row two">
          <div>
            <label for="evCompany">Compañía</label>
            <input id="evCompany" class="event-company" list="companyList" type="text" placeholder="Ej. OPEX / SLB / BHGE" />
            <datalist id="companyList">
              <option value="OPEX Perforadora"></option>
              <option value="SLB (Schlumberger)"></option>
              <option value="Baker Hughes"></option>
              <option value="Halliburton"></option>
              <option value="Weatherford"></option>
              <option value="Taurex"></option>
            </datalist>
          </div>
          <div>
            <label for="evLocation">Ubicación</label>
            <input id="evLocation" class="event-location" type="text" placeholder="Ej. Plataforma / Sala A" />
          </div>
        </div>

        <div class="form-row">
          <label for="evStaff">Personal asignado</label>
          <input id="evStaff" class="event-staff" type="text" placeholder="Ej. ESM, SME, DD, MWD..." />
        </div>

        <div class="form-row">
          <label for="evNotes">Notas</label>
          <textarea id="evNotes" class="event-notes" rows="3" placeholder="Indicaciones, riesgos, checklists, etc."></textarea>
        </div>
      </div>

      <div class="add-event-footer">
        <button class="add-event-btn" type="button">Guardar evento</button>
      </div>
    </div>
  </div>

  <!-- ===========================
       Firebase (Firestore) - CDN
       Reemplaza firebaseConfig con tus datos
       =========================== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, doc, setDoc, getDocs, query, where,
      onSnapshot, deleteDoc, updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ⬇️ PEGAR AQUÍ LA CONFIGURACIÓN REAL DESDE FIREBASE CONSOLE
  const firebaseConfig = {
    apiKey: "AIzaSyDnLhwTMl9tf2-d3ivBEOJ63CrR0HGyZn8",
    authDomain: "calendar-with-events-8aa18.firebaseapp.com",
    projectId: "calendar-with-events-8aa18",
    storageBucket: "calendar-with-events-8aa18.firebasestorage.app",
    messagingSenderId: "993114256985",
    appId: "1:993114256985:web:02197250cd4e171b556348",
    measurementId: "G-YK7FXCYNTX"
  };

    // Inicializa Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // API mínima para eventos (colección "events")
    async function listEventsByDay(y, m, d) {
      const q = query(collection(db, "events"),
        where("y", "==", y), where("m", "==", m), where("d", "==", d));
      const snap = await getDocs(q);
      return snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    function watchDay(y, m, d, cb) {
      const q = query(collection(db, "events"),
        where("y", "==", y), where("m", "==", m), where("d", "==", d));
      return onSnapshot(q, (snap) => {
        const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        cb(data);
      });
    }

    async function createEvent(ev) {
      const id = (crypto?.randomUUID && crypto.randomUUID()) || String(Date.now());
      await setDoc(doc(db, "events", id), {
        id,
        ...ev,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      });
      return id;
    }

    async function updateEvent(id, patch) {
      await updateDoc(doc(db, "events", id), {
        ...patch,
        updatedAt: serverTimestamp(),
      });
    }

    async function removeEvent(id) {
      await deleteDoc(doc(db, "events", id));
    }

    // Exponer para script.js
    window.$eventsAPI = { listEventsByDay, watchDay, createEvent, updateEvent, removeEvent };
  </script>

  <!-- Tu JS principal (adaptado a Firestore) -->
  <script src="script.js"></script>
</body>
</html>
